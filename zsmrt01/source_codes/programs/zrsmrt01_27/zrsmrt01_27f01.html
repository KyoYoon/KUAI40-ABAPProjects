<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<title>ZRSMRT01_27F01</title>
</head>
<body bgcolor="#FFFFE0">
<font size="3" face = "Arial" color="#000000"><b>Code listing for: ZRSMRT01_27F01</b></font>
<br>
<font size="3" face = "Arial" color="#000000"><b>Description:  Include ZRSMRT01_27F01</b></font>
<hr>
<pre width="100">
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&  Include           ZRSMRT01_27F01</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  SET_INIT_VALUE</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*  --&gt;  p1        text</font>
<font color ="#0000FF">*  &lt;--  p2        text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM set_init_value .

  p_bukrs = '1000'.
  p_budat = sy-datum.
  p_mode  = 'N'. "Background processing

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  POST_DOCUMENT</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*  --&gt;  p1        text</font>
<font color ="#0000FF">*  &lt;--  p2        text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM post_document .

  DATA : lv_msg TYPE string.

<font color ="#0000FF">*-- BDC Coding</font>
  CLEAR : gt_bdcdata, gs_bdcdata.

  PERFORM dynpro  USING : 'X' 'SAPMF05A' '0100',
                          ' ' 'BDC_OKCODE' '/00',
                          ' ' 'BKPF-BLDAT' p_budat,
                          ' ' 'BKPF-BLART' 'SA',
                          ' ' 'BKPF-BUKRS' p_bukrs,
                          ' ' 'BKPF-BUDAT' p_budat,
                          ' ' 'BKPF-WAERS' 'KRW',
                          ' ' 'BKPF-BKTXT' 'BDC Sample',
                          ' ' 'RF05A-NEWBS' '40',
                          ' ' 'RF05A-NEWKO' '113119',
                          'X' 'SAPMF05A' '0300',
                          ' ' 'BDC_OKCODE' '/00',
                          ' ' 'BSEG-WRBTR' '1000',
                          ' ' 'BSEG-SGTXT' sy-uname,
                          ' ' 'RF05A-NEWBS' '50',
                          ' ' 'RF05A-NEWKO' '113119',
                          'X' 'SAPLKACB' '0002',
                          ' ' 'BDC_OKCODE' '=ENTE',
                          ' ' 'COBL-GSBER' '1000',
                          'X' 'SAPMF05A' '0300',
                          ' ' 'BDC_OKCODE' '=BU',
                          ' ' 'BSEG-WRBTR' '1000',
                          ' ' 'BSEG-SGTXT' 'Credit item',
                          'X' 'SAPLKACB' '0002',
                          ' ' 'BDC_OKCODE' '=ENTE',
                          ' ' 'COBL-GSBER' '1000'.

<font color ="#0000FF">*  PERFORM dynpro USING : 'X' 'SAPMF05A' '0100',</font>
<font color ="#0000FF">*                         ' ' 'BDC_OKCODE' '/00',</font>
<font color ="#0000FF">*                         '' 'BKPF-BLDAT' p_budat,</font>
<font color ="#0000FF">*                         '' 'BKPF-BLART' 'SA',</font>
<font color ="#0000FF">*                         '' 'BKPF-BUKRS' p_bukrs,</font>
<font color ="#0000FF">*                         '' 'BKPF-BUDAT' p_budat,</font>
<font color ="#0000FF">*                         '' 'BKPF-MONAT' '4',</font>
<font color ="#0000FF">*                         '' 'BKPF-WAERS' 'KRW',</font>
<font color ="#0000FF">*                         '' 'BKPF-BKTXT' 'Test document STU01',</font>
<font color ="#0000FF">*                         '' 'FS006-DOCID' '*',</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWBS' '40',</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWKO' '113119',</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*                         'X' 'SAPMF05A' '0300',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '/00',</font>
<font color ="#0000FF">*                         '' 'BSEG-WRBTR' '5000',</font>
<font color ="#0000FF">*                         '' 'BSEG-VALUT' '',</font>
<font color ="#0000FF">*                         '' 'BSEG-SGTXT' 'Debit Item 1',</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWBS' '50',</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWKO' '113119',</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*                         'X' 'SAPLKACB' '0002',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '=ENTE',</font>
<font color ="#0000FF">*                         '' 'COBL-GSBER' '1000',</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*                         'X' 'SAPMF05A' '0300',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '=BU',</font>
<font color ="#0000FF">*                         '' 'BSEG-WRBTR' '5000',</font>
<font color ="#0000FF">*                         '' 'BSEG-VALUT' '2018.04.18',</font>
<font color ="#0000FF">*                         '' 'BSEG-SGTXT' 'Credit Item 1',</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">*                         'X' 'SAPLKACB' '0002',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '=ENTE',</font>
<font color ="#0000FF">*                         '' 'COBL-GSBER' '1000'.</font>

<font color ="#0000FF">*  PERFORM dynpro USING : 'X' 'SAPMF05A' '0100',</font>
<font color ="#0000FF">*                         ' '  'BDC_OKCODE' '/00',</font>
<font color ="#0000FF">*                         '' 'BKPF-BLDAT' p_budat ,</font>
<font color ="#0000FF">*                         '' 'BKPF-BLART' 'SA' ,</font>
<font color ="#0000FF">*                         '' 'BKPF-BUKRS' p_bukrs ,</font>
<font color ="#0000FF">*                         '' 'BKPF-BUDAT' p_budat ,</font>
<font color ="#0000FF">*                         '' 'BKPF-MONAT' '4',</font>
<font color ="#0000FF">*                         '' 'BKPF-WAERS' 'KRW',</font>
<font color ="#0000FF">*                         '' 'BKPF-BKTXT' 'Test',</font>
<font color ="#0000FF">*                         '' 'FS006-DOCID' '',</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWBS' '40',</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWKO' '113119',</font>
<font color ="#0000FF">*********************************************************************</font>
<font color ="#0000FF">*                         'X' 'SAPMF05A' '0300',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '/00',</font>
<font color ="#0000FF">*                         '' 'BSEG-WRBTR' '5000',</font>
<font color ="#0000FF">*                         '' 'BSEG-VALUT' '',</font>
<font color ="#0000FF">*                         '' 'BSEG-SGTXT' sy-uname,</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWBS' '50',</font>
<font color ="#0000FF">*                         '' 'RF05A-NEWKO' '113119',</font>
<font color ="#0000FF">*********************************************************************</font>
<font color ="#0000FF">*                         'X' 'SAPLKACB' '0002',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '=ENTE',</font>
<font color ="#0000FF">*                         '' 'COBL-GSBER' '1000',</font>
<font color ="#0000FF">*********************************************************************</font>
<font color ="#0000FF">*                         'X' 'SAPMF05A' '0300',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '=BU',</font>
<font color ="#0000FF">*                         '' 'BSEG-WRBTR' '5000',</font>
<font color ="#0000FF">*                         '' 'BSEG-VALUT' '2018.04.18',</font>
<font color ="#0000FF">*                         '' 'BSEG-SGTXT' 'Item2',</font>
<font color ="#0000FF">*********************************************************************</font>
<font color ="#0000FF">*                         'X' 'SAPLKACB' '0002',</font>
<font color ="#0000FF">*                         '' 'BDC_OKCODE' '=ENTE',</font>
<font color ="#0000FF">*                         '' 'COBL-GSBER' '1000'.</font>



  gs_param-dismode = p_mode.
  gs_param-updmode = 'S'.
  gs_param-nobiend = space.
  gs_param-racommit = 'X'.

  CLEAR : gt_messtab[], gt_messtab.

  CALL TRANSACTION 'FB01' USING gt_bdcdata
                          OPTIONS FROM gs_param
                          MESSAGES INTO gt_messtab.

  CLEAR gt_messtab.
  READ TABLE gt_messtab WITH KEY msgid  = 'F5'    "Message Class
                                 msgnr  = '312'.  "Message Number

  IF sy-subrc EQ 0.

    gs_body-belnr = gt_messtab-msgv1. " 전표번호
    gs_body-status = icon_led_green.
    CLEAR lv_msg.

    CALL FUNCTION 'MESSAGE_TEXT_BUILD'
      EXPORTING
        msgid               = gt_messtab-msgid
        msgnr               = gt_messtab-msgnr
        msgv1               = gt_messtab-msgv1
        msgv2               = gt_messtab-msgv2
        msgv3               = gt_messtab-msgv3
        msgv4               = gt_messtab-msgv4
      IMPORTING
        message_text_output = lv_msg.

    gs_body-msg = lv_msg.


  ELSE.

    gs_body-status = icon_led_red.

    CLEAR lv_msg.

    CALL FUNCTION 'MESSAGE_TEXT_BUILD'
      EXPORTING
        msgid               = gt_messtab-msgid
        msgnr               = gt_messtab-msgnr
        msgv1               = gt_messtab-msgv1
        msgv2               = gt_messtab-msgv2
        msgv3               = gt_messtab-msgv3
        msgv4               = gt_messtab-msgv4
      IMPORTING
        message_text_output = lv_msg.

    gs_body-msg = lv_msg.

  ENDIF.

  APPEND gs_body TO gt_body.
  CLEAR gs_body.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  DISPLAY_SCREEN</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*  --&gt;  p1        text</font>
<font color ="#0000FF">*  &lt;--  p2        text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM display_screen .

<font color ="#0000FF">*DATA : BEGIN OF gs_body,</font>
<font color ="#0000FF">*        belnr     TYPE bkpf-belnr, " FI Document Number</font>
<font color ="#0000FF">*        msg(100),                  " Result Message</font>
<font color ="#0000FF">*       END OF gs_body.</font>

<font color ="#0000FF">*-- Define Field Catalog</font>
  CLEAR : gt_fcat, gs_fcat.
  "key  Field      Text          Emphasize
  PERFORM set_field_catalog USING : 'X'   'STATUS'    '전표 생성 상태'      'X',
                                    'X'   'BELNR'    '회계 전표 번호'     'X',
                                    ' '   'MSG'    '결과 메시지'      'X'.


<font color ="#0000FF">*-- Display result data on screen 100</font>
  IF go_dock_cont IS INITIAL.

    PERFORM create_object.

<font color ="#0000FF">*-- ALV 를 위한 event 설치</font>
    SET HANDLER : go_event-&gt;handle_double_click       FOR go_alv_grid,  " &lt;instance name&gt;-&gt;&lt;instance method name&gt;
                  lcl_event_handler=&gt;handle_hotspot   FOR go_alv_grid.  " &lt;class name&gt;=&gt;&lt;static method name&gt;

<font color ="#0000FF">*-- ALV layout 설정</font>
    PERFORM set_layout.

<font color ="#0000FF">*-- Display ALV Grid</font>
    CALL METHOD go_alv_grid-&gt;set_table_for_first_display
      EXPORTING
<font color ="#0000FF">*       i_buffer_active =</font>
<font color ="#0000FF">*       i_bypassing_buffer            =</font>
<font color ="#0000FF">*       i_consistency_check           =</font>
<font color ="#0000FF">*       i_structure_name              = 'GT_BODY'</font>
<font color ="#0000FF">*       is_variant      =</font>
        i_save          = 'A'
        i_default       = 'X'
        is_layout       = gs_layout
<font color ="#0000FF">*       is_print        =</font>
<font color ="#0000FF">*       it_special_groups             =</font>
<font color ="#0000FF">*       it_toolbar_excluding          =</font>
<font color ="#0000FF">*       it_hyperlink    =</font>
<font color ="#0000FF">*       it_alv_graphics =</font>
<font color ="#0000FF">*       it_except_qinfo =</font>
<font color ="#0000FF">*       ir_salv_adapter =</font>
      CHANGING
        it_outtab       = gt_body
        it_fieldcatalog = gt_fcat
<font color ="#0000FF">*       it_sort         =</font>
<font color ="#0000FF">*       it_filter       =</font>
<font color ="#0000FF">*      EXCEPTIONS</font>
<font color ="#0000FF">*       invalid_parameter_combination = 1</font>
<font color ="#0000FF">*       program_error   = 2</font>
<font color ="#0000FF">*       too_many_lines  = 3</font>
<font color ="#0000FF">*       others          = 4</font>
      .

  ELSE.

<font color ="#0000FF">*-- ALV Grid Refresh</font>
    CALL METHOD go_alv_grid-&gt;refresh_table_display.

  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  SET_FIELD_CATALOG</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*      --&gt;P_0025   text</font>
<font color ="#0000FF">*      --&gt;P_0026   text</font>
<font color ="#0000FF">*      --&gt;P_0027   text</font>
<font color ="#0000FF">*      --&gt;P_0028   text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM set_field_catalog   USING pv_key pv_field pv_text pv_emphasize.

  gs_fcat-key       = pv_key.
  gs_fcat-fieldname = pv_field.
  gs_fcat-coltext   = pv_text.
  gs_fcat-emphasize = pv_emphasize.

  CASE pv_field.
    WHEN 'BELNR'.   "FI document number 일 때 hotspot 이벤트 설정
      gs_fcat-hotspot = 'X'.
  ENDCASE.

  APPEND gs_fcat TO gt_fcat.
  CLEAR gs_fcat.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  DOUBLE_CLICK</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*      --&gt;P_E_ROW  text</font>
<font color ="#0000FF">*      --&gt;P_E_COLUMN  text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM double_click  USING pv_row pv_column.

<font color ="#0000FF">**-- Call function to get bseg data</font>
<font color ="#0000FF">*  PERFORM get_bseg_data USING pv_row.</font>
<font color ="#0000FF">*</font>
<font color ="#0000FF">**-- CALL SCREEN 110 (Popup)</font>
<font color ="#0000FF">*  IF gv_flag EQ 'S'.</font>
<font color ="#0000FF">*    PERFORM call_popup.</font>
<font color ="#0000FF">*  ELSE.</font>
<font color ="#0000FF">*    MESSAGE s037 DISPLAY LIKE 'E'.</font>
<font color ="#0000FF">**    EXIT.</font>
<font color ="#0000FF">*  ENDIF.</font>

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  HOTSPOT_CLICK</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*      --&gt;P_E_ROW_ID  text</font>
<font color ="#0000FF">*      --&gt;P_E_COLUMN_ID  text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM hotspot_click  USING pv_row_id pv_column_id.

<font color ="#0000FF">*-- 전표번호 클릭과 동시에 전표조회화면 (FB03) 으로 이동하기</font>
<font color ="#0000FF">*-- 클릭한 데이터 관련 레코드 가져오기 (행 번호 이용)</font>
  CLEAR gs_body.
  READ TABLE gt_body INTO gs_body INDEX pv_row_id.

<font color ="#0000FF">*-- Using SAP Memory in order to put material number</font>
<font color ="#0000FF">*-- 매개변수 ID (Parameter Value ID) 에 값을 넣기만 하면 FB03 에서 자동으로 값을 세팅해서 보여줌</font>
  SET PARAMETER ID 'BLN' FIELD gs_body-belnr.   " FI dcoument number 셋팅
  SET PARAMETER ID 'BUK' FIELD p_bukrs.   " Company code 셋팅
  SET PARAMETER ID 'GJR' FIELD p_budat(4).   " Fiscal year 셋팅

<font color ="#0000FF">*-- Calling a Transaction (Module Pool)</font>
  CALL TRANSACTION 'FB03' AND SKIP FIRST SCREEN.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  CREATE_OBJECT</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*  --&gt;  p1        text</font>
<font color ="#0000FF">*  &lt;--  p2        text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM create_object .

<font color ="#0000FF">*-- create docking container</font>
  CREATE OBJECT go_dock_cont
    EXPORTING
      repid     = sy-repid " report name -&gt; sy-cprog 도 사용가능
      dynnr     = sy-dynnr " screen name 현재 세션의 screen 번호
      side      = go_dock_cont-&gt;dock_at_left  " instance name-&gt;instance method '-&gt;'로 참조 (왼쪽 기준)
      extension = 3000.

<font color ="#0000FF">*-- create alv grid</font>
  CREATE OBJECT go_alv_grid
    EXPORTING
<font color ="#0000FF">*     i_shellstyle      = 0</font>
<font color ="#0000FF">*     i_lifetime        =</font>
      i_parent = go_dock_cont.

<font color ="#0000FF">*-- create event</font>
  CREATE OBJECT go_event.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  SET_LAYOUT</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*  --&gt;  p1        text</font>
<font color ="#0000FF">*  &lt;--  p2        text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM set_layout .

  gs_layout-zebra       = 'X'.  " Line separator
  gs_layout-cwidth_opt  = 'X'.  " Width Optimization
  gs_layout-sel_mode    = 'D'.  " Multi selection
  gs_layout-grid_title  = 'BDC Processing Result'.  " Grid title
  gs_layout-smalltitle  = 'X'.  " Small title

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      Form  DYNPRO</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*       text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
<font color ="#0000FF">*      --&gt;P_0022   text</font>
<font color ="#0000FF">*      --&gt;P_0023   text</font>
<font color ="#0000FF">*      --&gt;P_0024   text</font>
<font color ="#0000FF">*----------------------------------------------------------------------*</font>
FORM dynpro  USING pv_dynbegin pv_name pv_value.

  CLEAR : gs_bdcdata.
  IF pv_dynbegin EQ 'X'.  " 스크린이 시작한다면 스크린 정보를 담는 로직 수행
    MOVE: pv_name        TO gs_bdcdata-program,
          pv_value       TO gs_bdcdata-dynpro,
          pv_dynbegin    TO gs_bdcdata-dynbegin.

  ELSE.                   " 필드 정보를 담는 로직 수행
    MOVE: pv_name        TO gs_bdcdata-fnam,
          pv_value       TO gs_bdcdata-fval.

  ENDIF.

  APPEND gs_bdcdata TO gt_bdcdata.



ENDFORM.
</pre>
<hr>
<font size="2" face = "Sans Serif">Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 750
</font>
</body>
</html>
